!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,o.qbMediaRecorder=e()}}(function(){return function e(o,r,t){function i(a,d){if(!r[a]){if(!o[a]){var s="function"==typeof require&&require;if(!d&&s)return s(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};o[a][0].call(u.exports,function(e){var r=o[a][1][e];return i(r?r:e)},u,u.exports,e,o,r,t)}return r[a].exports}for(var n="function"==typeof require&&require,a=0;a<t.length;a++)i(t[a]);return i}({1:[function(e,o,r){"use strict";var t={unsupport:"qbMediaRecorder is not supported this environment.",unsupportMediaRecorderWithOptions:"Got a warning when creating a MediaRecorder, trying to create MediaRecorder without options.",callbackError:"Founded an error in callback:",actionFailed:"qbMediaRecorder is not created or has an invalid state.",no_recorded_chunks:"Does not have any recording data.",streamRequired:"MediaStream is required.",InvalidState:"qbMediaRecorder is not in a state in which the proposed operation is allowed to be executed.",OutOfMemory:"The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",IllegalStreamModification:"A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",OtherRecordingError:"Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",GenericError:"The UA cannot provide the codec or recording option that has been requested"};o.exports=t},{}],2:[function(e,o,r){"use strict";function t(e,o){var r=this;if(!t.isAvailable())throw new Error(i.unsupport);r._stream=e,r._mediaRecorder=null,r._recordedChunks=[],r._timeSlice=o&&o.timeSlice?o.timeSlice:1e3,r._userCallbacks=o&&o.callbacks?o.callbacks:null;var n="video",a=o&&o.mimeType;a&&(n=a.toString().toLowerCase().indexOf("audio")===-1?"video":"audio"),r._options={mimeType:t.getSupportedMimeTypes(n,a)[0],ignoreMutedMedia:!o||void 0===typeof o.ignoreMutedMedia||o.ignoreMutedMedia}}var i=e("./errors");t.isAvailable=function(){return!(!window||!window.MediaRecorder||"function"!=typeof window.MediaRecorder.isTypeSupported)},t._mimeTypes={audio:["audio/webm;codecs=opus","audio/webm","audio/ogg"],video:["video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm","video/mp4","video/mpeg"]},t.getSupportedMimeTypes=function(e){var o=e||"video";if(!t.isAvailable())throw new Error(i.unsupport);return t._mimeTypes[o].filter(function(e){return window.MediaRecorder.isTypeSupported(e)})},t.prototype.getState=function(){return this._mediaRecorder?this._mediaRecorder.state:"inactive"},t.prototype.start=function(e){function o(e,o){if(r._userCallbacks&&"function"==typeof r._userCallbacks[e])try{r._userCallbacks[e](o)}catch(o){console.error("Founded an error in callback:"+e,o)}}var r=this,t=r.getState();"recording"!==t&&"paused"!==t||r._mediaRecorder.stop(),e&&(r._stream.length=0,r._stream=e),r._mediaRecorder=null,r._recordedChunks.length=0;try{r._mediaRecorder=new window.MediaRecorder(r._stream,r._options)}catch(e){console.info(i.unsupportMediaRecorderWithOptions,e),r._mediaRecorder=new window.MediaRecorder(r._stream)}r._mediaRecorder.ondataavailable=function(e){e.data&&e.data.size>0&&r._recordedChunks.push(e.data)},r._mediaRecorder.onpause=function(){o("onPause")},r._mediaRecorder.onresume=function(){o("onResume")},r._mediaRecorder.onerror=function(e){switch(e.name){case"InvalidState":console.error(i[e.name]);break;case"OutOfMemory":console.error(i[e.name]);break;case"IllegalStreamModification":console.error(i[e.name]);break;case"OtherRecordingError":console.error(i[e.name]);break;case"GenericError":console.error(i[e.name]);break;default:console.error("MediaRecorder Error",e)}"inactive"!==r._mediaRecorder.state&&"stopped"!==r._mediaRecorder.state&&r._mediaRecorder.stop(),r._userCallbacks&&"function"==typeof r._userCallbacks.onErrorRecording&&o("onError",e)},r._mediaRecorder.onstop=function(e){var t=new Blob(r._recordedChunks,{type:r._options.mimeType});o("onStop",t)},r._mediaRecorder.start(r._timeSlice),o("onStart")},t.prototype.stop=function(){var e=this._mediaRecorder,o=e&&e.state?e.state:"inactive";e&&"recording"===o?e.stop():console.warn(i.actionFailed)},t.prototype.pause=function(){var e=this;e._mediaRecorder&&"recording"===e._mediaRecorder.state?e._mediaRecorder.pause():console.warn(i.actionFailed)},t.prototype.resume=function(){var e=this;e._mediaRecorder&&"paused"===e._mediaRecorder.state?e._mediaRecorder.resume():console.warn(i.actionFailed)},t.prototype.download=function(e,o){var r=this,t=this._mediaRecorder,i=t&&t.state?t.state:"inactive";t&&"recording"===i&&t.stop();var n=URL.createObjectURL(o||r._getBlobRecorded()),a=document.createElement("a");a.style.display="none",a.href=n,a.download=(e||Date.now())+"."+r._getExtension(),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(n)},100)},t.prototype._getBlobRecorded=function(e){var o=this,r=e||o._recordedChunks;return r.length?new Blob(r,{type:o._options.mimeType}):(console.warn(i.no_recorded_chunks),!1)},t.prototype._getExtension=function(){var e=this,o=e._options.mimeType.indexOf("/"),r=e._options.mimeType.substring(o+1),t=r.indexOf(";");return t!==-1&&(r=r.substring(0,t)),r},o.exports=t},{"./errors":1}]},{},[2])(2)});